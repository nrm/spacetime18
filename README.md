# Документация по запуску и развертыванию

## Запуск main.py

Этот проект предоставляет скрипт для запуска основного процесса обработки изображений, который использует два входных файла: crop_name и layout_name.

### 1. Клонирование репозитория

Сначала клонируйте репозиторий на локальную машину.

```sh
git clone https://github.com/nrm/spacetime18
cd spacetime18
```

### 2. Создание и активация виртуального окружения (virtualenv)

Рекомендуется использовать виртуальное окружение для изоляции зависимостей проекта. Для этого выполните следующие шаги:
Установка virtualenv (если ещё не установлен)

```sh
pip install virtualenv
```

Создание виртуального окружения

```sh
virtualenv venv
```

Активация виртуального окружения

На Windows:

```sh
venv\Scripts\activate
```

На macOS и Linux:

```sh
source venv/bin/activate
```


### 3. Установка зависимостей

Убедитесь, что у вас установлен Python версии 3.8 или выше. Затем установите зависимости, используя файл requirements.txt:

```sh
pip install -r requirements.txt
```

### 4. Запуск скрипта

Скрипт main.py принимает два аргумента: crop_name и layout_name, которые представляют собой пути к файлам снимка и подложки соответственно.

Пример команды для запуска скрипта:

```sh
python main.py --crop_name /path/to/crop_file.tif --layout_name /path/to/layout_file.tif
```

Доступные ключи скрипта

    --crop_name: (обязательный) Путь к файлу обрезки. Например, /path/to/crop_file.tif.
    --layout_name: (обязательный) Путь к файлу подложки. Например, /path/to/layout_file.tif.

Пример

Допустим, у вас есть файл снимка crop_0_2_0000.tif и файл подложки layout_2022-03-17.tif, которые находятся в директориях /data/crops и /data/layouts соответственно. Для запуска процесса выполните следующую команду:

```sh
python main.py --crop_name /data/crops/crop_0_2_0000.tif --layout_name /data/layouts/layout_2022-03-17.tif
```

Примечание

В скрипте main.py переменная taskid фиксирована как coords.csv. Это означает, что результаты обработки будут записаны в файл coords.csv в текущей рабочей директории. Вы можете изменить эту переменную в коде, если хотите задать другое имя файла для сохранения результатов.




## Использование API версии (в разработке)

### Установка зависимостей

Установите docker и docker-compose как описано в официальной документации [Docker](https://docs.docker.com/compose/install/).

### Переменные окружения

В Dockerfile и docker-compose.yml, мы устанавливаем переменную окружения LAYOUTS_DIR, которая предоставляет путь к директории с подложками и используется приложением внутри контейнера.

А так же монтируем внутрь контейнера папку с подложками.

```yaml
...
volumes:
    - ./path/2/layouts:/layouts
environment:
    - LAYOUTS_DIR=/layouts
```

## Запуск приложения с Docker Compose

Соберите и запустите контейнер:

```sh
docker compose up --build
```

Приложение будет доступно по адресу http://localhost:8000.

## Пример работы с API

 Описан в файле API_docs.md
